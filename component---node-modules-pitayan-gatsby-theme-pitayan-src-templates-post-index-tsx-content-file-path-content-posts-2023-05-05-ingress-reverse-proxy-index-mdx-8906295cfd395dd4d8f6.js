"use strict";(self.webpackChunkwww=self.webpackChunkwww||[]).push([[1835],{7321:function(e,t,a){a.r(t),a.d(t,{default:function(){return S}});var n=a(1151),s=a(7294);function r(e){const t=Object.assign({h2:"h2",a:"a",span:"span",p:"p",h3:"h3"},(0,n.ah)(),e.components);return s.createElement(s.Fragment,null,s.createElement(t.h2,{id:"introduction",style:{position:"relative"}},s.createElement(t.a,{href:"#introduction","aria-label":"introduction permalink",className:"heading-anchor before"},s.createElement(t.span,{dangerouslySetInnerHTML:{__html:"<span>#</span>"}})),"Introduction"),"\n",s.createElement(t.p,null,"While discussing reverse proxies with a colleague who was building out his home lab with Docker, the topic of SSL certificates and proxies came up. I mentioned that I use Kubernetes, cert-manager, and Let’s Encrypt to manage these components. However, this made me consider the fact that although most of my services are hosted within Kubernetes, there are still some that run on other platforms, including bare-metal."),"\n",s.createElement(t.p,null,"As a result, I began to wonder if I should configure NGINX Proxy Manager or Traefik on Docker to manage certificates for these external services. Alternatively, could it be possible to leverage Kubernetes’ internal resource management capabilities for external resources as well?"),"\n",s.createElement(t.p,null,"The short answer is “You bet!” Let’s explore how we can accomplish this."),"\n",s.createElement(t.h2,{id:"components",style:{position:"relative"}},s.createElement(t.a,{href:"#components","aria-label":"components permalink",className:"heading-anchor before"},s.createElement(t.span,{dangerouslySetInnerHTML:{__html:"<span>#</span>"}})),"Components"),"\n",s.createElement(t.p,null,"To get this up and running, you will need a Kubernetes cluster with a working Ingress Controller and Cert-Manager installed."),"\n",s.createElement(t.p,null,"A reverse proxy typically requires three manifests: Endpoint, Service, and Ingress. These manifests define the endpoints and services to be exposed by the Ingress Controller and the rules for routing traffic to them."),"\n",s.createElement(t.p,null,"An Endpoint manifest defines the IP address and port of an external service. A Service manifest exposes the endpoint as a Kubernetes Service object, which can then be used by the Ingress Controller to route traffic to the endpoint."),"\n",s.createElement(t.p,null,"Finally, an Ingress manifest defines the rules for routing traffic to the Service objects. It specifies the hostname, path, and other criteria for routing traffic to the appropriate Service object."),"\n",s.createElement(t.p,null,"Below are example manifests for each of these components. Note that these are not intended to be copy-pasted directly, but rather serve as a starting point for building your own manifests that are specific to your environment and requirements."),"\n",s.createElement(t.h3,{id:"endpoint",style:{position:"relative"}},s.createElement(t.a,{href:"#endpoint","aria-label":"endpoint permalink",className:"heading-anchor before"},s.createElement(t.span,{dangerouslySetInnerHTML:{__html:"<span>#</span>"}})),"Endpoint"),"\n",s.createElement(t.p,null,"An endpoint is the network address of a pod that provides a specific service in the cluster. like a phone number that connects you to a specific person. Endpoints are dynamically created by Kubernetes based on the state of the pods in the cluster and they represent the availability of a particular service. When a service is created, it is associated with one or more endpoints. These endpoints are then used to direct traffic to the appropriate pod that is providing the service. In summary, an endpoint is a reference to a specific pod that is providing a service, and it’s used by Kubernetes to route traffic to the correct location."),"\n",s.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml">\n<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1\n<span class="token key atrule">kind</span><span class="token punctuation">:</span> Endpoints\n<span class="token key atrule">metadata</span><span class="token punctuation">:</span>\n  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>external<span class="token punctuation">-</span>service\n<span class="token key atrule">subsets</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> <span class="token key atrule">addresses</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">ip</span><span class="token punctuation">:</span> 10.1.2.3\n    <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>\n</code></pre></div>'}}),"\n",s.createElement(t.h3,{id:"service",style:{position:"relative"}},s.createElement(t.a,{href:"#service","aria-label":"service permalink",className:"heading-anchor before"},s.createElement(t.span,{dangerouslySetInnerHTML:{__html:"<span>#</span>"}})),"Service"),"\n",s.createElement(t.p,null,"In Kubernetes, a service is like a virtual front door that allows communication between different parts of a software application running on a cluster. Think of it like a receptionist who directs visitors to the right person or department. The service has a name and a fixed IP address that can be used by other parts of the application to communicate with it. It also helps to ensure that communication between different parts of the application is reliable and efficient, even if the underlying physical components change over time. In short, a Kubernetes service is an important tool for making sure that different parts of a software application can talk to each other effectively and without interruptions."),"\n",s.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml">\n<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1\n<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service\n<span class="token key atrule">metadata</span><span class="token punctuation">:</span>\n  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>external<span class="token punctuation">-</span>service\n<span class="token key atrule">spec</span><span class="token punctuation">:</span>\n  <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>\n      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>\n  <span class="token key atrule">selector</span><span class="token punctuation">:</span>\n    <span class="token key atrule">app</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>external<span class="token punctuation">-</span>app\n</code></pre></div>'}}),"\n",s.createElement(t.h3,{id:"ingress",style:{position:"relative"}},s.createElement(t.a,{href:"#ingress","aria-label":"ingress permalink",className:"heading-anchor before"},s.createElement(t.span,{dangerouslySetInnerHTML:{__html:"<span>#</span>"}})),"Ingress"),"\n",s.createElement(t.p,null,"An Ingress manifest in Kubernetes is a configuration file that tells the cluster how to handle incoming internet traffic. It’s like a map that tells the cluster which web addresses and web pages to show to people who visit the website. It’s used to control how traffic flows into and out of the cluster, making it possible to manage multiple services and web pages from a single point of entry. It’s a way to make sure that the right web pages are shown to the right people, and it makes it possible to add things like security features and load balancing to the website."),"\n",s.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml">\n<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1\n<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress\n<span class="token key atrule">metadata</span><span class="token punctuation">:</span>\n  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>ingress\n  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>\n    <span class="token key atrule">cert-manager.io/cluster-issuer</span><span class="token punctuation">:</span> <span class="token string">"letsencrypt-prod"</span>\n<span class="token key atrule">spec</span><span class="token punctuation">:</span>\n  <span class="token key atrule">tls</span><span class="token punctuation">:</span>\n    <span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span>\n        <span class="token punctuation">-</span> my.domain.com\n      <span class="token key atrule">secretName</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>tls<span class="token punctuation">-</span>secret\n  <span class="token key atrule">rules</span><span class="token punctuation">:</span>\n    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> my.domain.com\n      <span class="token key atrule">http</span><span class="token punctuation">:</span>\n        <span class="token key atrule">paths</span><span class="token punctuation">:</span>\n          <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /api\n            <span class="token key atrule">pathType</span><span class="token punctuation">:</span> Prefix\n            <span class="token key atrule">backend</span><span class="token punctuation">:</span>\n              <span class="token key atrule">service</span><span class="token punctuation">:</span>\n                <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>external<span class="token punctuation">-</span>service\n                <span class="token key atrule">port</span><span class="token punctuation">:</span>\n                  <span class="token key atrule">name</span><span class="token punctuation">:</span> http\n\n</code></pre></div>'}}),"\n",s.createElement(t.h2,{id:"summary",style:{position:"relative"}},s.createElement(t.a,{href:"#summary","aria-label":"summary permalink",className:"heading-anchor before"},s.createElement(t.span,{dangerouslySetInnerHTML:{__html:"<span>#</span>"}})),"Summary"),"\n",s.createElement(t.p,null,"In Kubernetes, an Ingress Controller is like a traffic cop at the entrance of a cluster. It controls incoming traffic and directs it to the appropriate services. When a request comes in from outside the cluster, the Ingress Controller uses information from the Ingress Manifest to determine how to route the traffic. The Ingress Manifest specifies the hostnames, paths, and ports that should be exposed, as well as the routing rules for directing traffic to the appropriate services."),"\n",s.createElement(t.p,null,"To route traffic to external services, the Ingress Controller uses Endpoints and Services. An Endpoint is the network address of a pod that provides a specific service in the cluster. A Service is a logical entity that groups together a set of pods and provides a stable IP address and DNS name that other pods can use to access the service."),"\n",s.createElement(t.p,null,"To connect to an external service, the Ingress Controller first creates a Service that points to the external service. The Service has a stable IP address that other pods can use to connect to the external service. Next, the Ingress Controller creates an Endpoint that maps the Service to the actual IP address and port of the external service. The Ingress Controller then uses this Endpoint to route traffic to the external service."),"\n",s.createElement(t.p,null,"If you combine Cert-Manager with the Ingress Controller you can secure external traffic by automating the management and issuance of SSL certificates. The Ingress Manifest specifies the TLS configuration and Cert-Manager generates SSL certificates, stores them as Kubernetes Secrets, and the Ingress Controller uses them to terminate SSL connections and route traffic to the correct location within the Kubernetes cluster."),"\n",s.createElement(t.p,null,"Please note that this post is a copy of the original article published on my blog at https://blog.antnsn.dev/2023-p2-ingress-as-a-reverse-proxy/. Check out my website for more content related to Cloud native, terraform and kubernetes."))}var o=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,n.ah)(),e.components);return t?s.createElement(t,e,s.createElement(r,e)):r(e)},l=a(1883),c=a(9352),i=a(8032),p=a(7896),u=a(5916),m=a(197),d=a(5911),h=a(8762),k=a(9586),f=a(9951),g=a(9286),y=a(2271),b=a(5437),v=a(5555),E=a(5648),w=a(7660),x=a(8188);const I=e=>{let{image:t}=e;return t?s.createElement(i.G,{className:"gatsby-resp-image-image",image:t,alt:""}):null},N=e=>{let{data:{mdx:{body:t,tableOfContents:a,frontmatter:{author:r,title:o,date:N,categories:S,hero:T,description:C,keywords:L},fields:{slug:j},timeToRead:_,relatedPosts:M}},pageContext:{tableOfContentsLevels:Z,previous:K,next:P},children:H}=e;const A=(0,s.useRef)(null),R=(0,i.c)(null==T?void 0:T.medium),{siteUrl:W}=(0,E.$W)(),{href:D}=(0,p.useLocation)(),O=r.map((e=>{let{id:t,yamlId:a,name:n,bio:s,sns:r}=e;return{id:t,yamlId:a,name:n,bio:s,socialUrls:r.filter((e=>"mailto"!=e[0]&&"url"!=e[0])).map((e=>w.$s[e[0]].url+"/"+e[1]))}}));return s.createElement(u.Z,{postDescription:C,pageImage:R.images.fallback.src,pageUrl:""+W+j,postTitle:o,pageTitle:o,keywords:L,date:N,timeToRead:_,authors:O},s.createElement(y.Z,{ref:A}),s.createElement("div",{className:"hidden md:block"},s.createElement(b.Z,{className:"fixed right-[6%] bottom-[6%] flex flex-col justify-center z-50"},s.createElement(f.Z,null))),s.createElement("div",{className:"max-w-lg md:max-w-2xl mx-auto mb-24"},s.createElement("h1",{className:"text-center"},o),s.createElement(m.Z,{className:"block mb-4 text-center",date:N,timeToRead:_}),s.createElement("div",{className:"block sm:flex flex-wrap items-center justify-center sm:justify-between"},s.createElement(g.Z,{data:r}),s.createElement(h.Z,{url:D,title:o,hashtags:S.join(","),description:C,className:"space-x-6 text-xl py-4 justify-center",twitter:!0,facebook:!0,linkedin:!0,pocket:!0,copy:!0}))),s.createElement("div",{className:"text-center mb-24"},s.createElement(I,{image:R})),s.createElement("div",{className:"lg:grid lg:grid-cols-9 lg:gaps-5"},s.createElement(h.Z,{url:D,title:o,hashtags:S.join(","),description:C,className:"hidden lg:flex text-xl mt-12 flex-col lg:col-start-1 lg:col-end-3 top-[2rem] sticky self-start max-h-full overflow-y-auto space-y-6",twitter:!0,facebook:!0,linkedin:!0,pocket:!0,copy:!0}),s.createElement("article",{className:"markdown lg:col-start-3 lg:col-end-8",ref:A},s.createElement(n.Zo,{components:{}},H)),s.createElement(v.Z,{className:"hidden lg:block lg:col-span-2 mt-12 top-[2rem] sticky self-start text-xs font-semibold ml-12 mr-auto mb-6 overflow-y-auto max-h-full",items:a.items,ref:A,levels:Z})),s.createElement("div",{className:"my-8 max-w-lg md:max-w-2xl mx-auto"},s.createElement("div",{className:"block sm:flex flex-wrap items-center justify-center sm:justify-between"},s.createElement(k.Z,{className:"my-8 justify-center",categories:S}),s.createElement(h.Z,{url:D,title:o,hashtags:S.join(","),description:C,className:"space-x-6 text-xl my-8 justify-center",twitter:!0,facebook:!0,linkedin:!0,pocket:!0,copy:!0})),s.createElement("div",{className:"flex justify-around flex-wrap text-base mt-12 mb-24"},s.createElement("div",{className:"p-4 my-4 bg-gray-50 border border-solid border-gray-100 dark:bg-gray-800 dark:border-gray-800 rounded mr-auto w-full md:w-[49%]"},s.createElement(l.Link,{to:K.slug,className:"site-link my-2 block"},s.createElement("div",{className:"flex items-start space-x-2"},s.createElement(c.YG0,{className:"block h-6 w-6"}),s.createElement("span",null,K.title)))),s.createElement("div",{className:"p-4 my-4 bg-gray-50 border border-solid border-gray-100 dark:bg-gray-800 dark:border-gray-800 rounded ml-auto w-full md:w-[49%]"},s.createElement(l.Link,{to:P.slug,className:"site-link my-2 block text-right"},s.createElement("div",{className:"flex items-start space-x-2 justify-end"},s.createElement("span",null,P.title),s.createElement(c.nzV,{className:"block h-6 w-6"}))))),s.createElement("h5",{className:"text-center mb-12"},"Written by"),r.map((e=>{let{bio:t,name:a,initial:n,avatar:r,sns:o,yamlId:l}=e;return s.createElement(d.Z,{className:"p-8 mb-4 bg-gray-50 border border-solid border-gray-100 dark:bg-gray-800 dark:border-gray-800 rounded",key:l,bio:t,name:a,initial:n,avatar:r,sns:o,yamlId:l})}))),s.createElement("div",{className:"my-24 max-w-lg sm:max-w-full mx-auto"},s.createElement("h5",{className:"mb-12 text-center"},"Related Posts"),s.createElement(x.Z,{posts:M,className:"grid sm:grid-cols-3 row-auto auto-cols-auto gap-8"})))};function S(e){return s.createElement(N,e,s.createElement(o,e))}}}]);
//# sourceMappingURL=component---node-modules-pitayan-gatsby-theme-pitayan-src-templates-post-index-tsx-content-file-path-content-posts-2023-05-05-ingress-reverse-proxy-index-mdx-8906295cfd395dd4d8f6.js.map