{"componentChunkName":"component---node-modules-pitayan-gatsby-theme-pitayan-src-templates-post-index-tsx-content-file-path-home-runner-work-blog-blog-content-posts-2023-03-12-bulk-triage-ips-with-alienvault-and-python-index-mdx","path":"/bulk-triage-ips/","result":{"data":{"mdx":{"body":"\n# Python and Alienvault\n\nI recently identified the need to perform a triage on several hundred IPs extracted from a log that was not associated with any SIEM or CTI solution. To address this, I utilized simple scripting techniques to compile the data into a user-friendly list of IPs for Python to interpret. Despite my efforts to locate a suitable tool for this purpose, the majority of my findings consisted of outdated and extensive codebases, making it difficult to pinpoint my specific requirements. As a result, I seized the opportunity to write a simple tool to meet my needs. Although the code may not be aesthetically pleasing, it effectively provides the necessary feedback. I am confident that this code snippet can be of great value to others facing similar challenges, and the best part is that it does not require any prior coding experience to utilize and generate results. Just add in your Alienvault API key and the list of IPs as commented in the code and run it like any other python script.\n\nThis script performs a comprehensive analysis of each IP address provided, cross-referencing it with information from AlienVault. Specifically, it examines any suspicious activity within the malware section that occurred within the timeframe defined by the variable lookback (which is currently set to 30 days). Upon completion of the analysis, each IP address is stored in the designated file ```ips.txt```.\n\n\n```python\nfrom datetime import datetime, timedelta\nimport json\nimport requests\nimport os\nimport concurrent.futures\n\nlookback = 30\n\nimport os\n\nfilename = 'ips.txt'\n# Create file if not existing\nif not os.path.exists(filename):\n    open(filename, 'w').close()\n\n# Insert your AlienVault API key\nAPI_KEY = \"\"\n\n# Insert a list of IP addresses to check\nips = []\n\n\nOTX_API_ENDPOINT = \"https://otx.alienvault.com/api/v1/indicators/IPv6/{ip}/{malware}\"\nHEADERS = {\"X-OTX-API-KEY\": API_KEY}\n\ndef check_date(date_str):\n    date = datetime.strptime(date_str.split('T')[0], '%Y-%m-%d')\n    delta = datetime.now() - date\n    if delta < timedelta(days=lookback):\n        return True\n\ntriage_ips = []\nwith open('ips.txt', 'r') as f:\n    existing_ips = set(f.read().splitlines())\n\nwith open('ips.txt', 'a') as f:\n    with requests.Session() as session:\n        def process_ip(ip):\n            if ip in existing_ips:\n                print(f\"Skipping {ip} as it already exists in the file\")\n                return\n\n            try:\n                with session.get(f\"https://otx.alienvault.com/api/v1/indicators/IPv4/{ip}/reputation\", stream=True) as reputation:\n                    reputation.raise_for_status()\n                    reputation_data = reputation.json()\n                with session.get(f\"https://otx.alienvault.com/api/v1/indicators/IPv4/{ip}/malware\", stream=True) as malware:\n                    malware.raise_for_status()\n                    malware_data = malware.json()\n                    date_values = [d['date'] for d in malware_data['data']]\n                    for date in date_values:\n                        if check_date(date):\n                            triage_ips.append(ip)\n                            print(ip)\n                            f.write(f\"{ip}\\n\")\n                            break\n            except requests.exceptions.HTTPError as e:\n                print(f\"Error: {e} for {ip}\")\n            except json.decoder.JSONDecodeError:\n                print(f\"Error: JSON decoding failed for {ip}\")\n\n        with concurrent.futures.ThreadPoolExecutor() as executor:\n            executor.map(process_ip, ips)\n\nprint(\"Triage these IPs:\", triage_ips)\n\n```\n\n\nMoving forward, it would be interesting to add a few triage levels based on different lookbacks stored in separate files for 7 days, 14 days and 30 days and possibly avoid duplicates between them (where the most recent IP activity gets precedense).\n\nAny additions or suggestions, please reach out through ![github](https://github.com/amestofortytwo/python_snippets) issues or any other SoMe.","timeToRead":2.33,"tableOfContents":{"items":[{"url":"#python-and-alienvault","title":"Python and Alienvault"}]},"frontmatter":{"author":[{"id":"7efe43a5-8dae-5391-b8c0-1c2acebf8c2e","yamlId":"adriankydlandskaftun","name":"Adrian Kydland Skaftun","initial":"AKS","bio":"Cyber security engineer\n","sns":[["linkedin","https://www.linkedin.com/in/akskaftun/"],["github","https://github.com/bittib010"],["mailto","mailto:adrian.skaftun@amesto.no"]],"avatar":{"normal":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAVABQDASIAAhEBAxEB/8QAGQABAQADAQAAAAAAAAAAAAAAAAQBAgMF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQIA/9oADAMBAAIQAxAAAAGrEnUrqkaZtSj0Qb//xAAaEAACAwEBAAAAAAAAAAAAAAABAgAREiED/9oACAEBAAEFAm4FPdkzR1dG57MWfXSwn//EABkRAAEFAAAAAAAAAAAAAAAAAAABAhARIf/aAAgBAwEBPwFqYVP/xAAZEQABBQAAAAAAAAAAAAAAAAAAAQIQESH/2gAIAQIBAT8Bculz/8QAHBAAAgICAwAAAAAAAAAAAAAAAAECEBEhMWFx/9oACAEBAAY/Aq5HKWcd34I3FM//xAAaEAEAAwEBAQAAAAAAAAAAAAABABEhMVFh/9oACAEBAAE/IX85SaewFa7jSAWCIVDLjNIcOCLXAE8mG19Z/9oADAMBAAIAAwAAABCr6MP/xAAYEQADAQEAAAAAAAAAAAAAAAAAAREQIf/aAAgBAwEBPxBa7xWU/8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAR/9oACAECAQE/EFdFuwsL/8QAHBABAQEBAAIDAAAAAAAAAAAAAREAITFRQYGh/9oACAEBAAE/EJqsLHCQxE+nCOK7GZ4MiYL8T93lQih7mnAZzxlqKyDwZ5mGQh3jvvJ4wSvXf//Z"},"images":{"fallback":{"src":"/static/cccbb7c63b7ff3e3ed1d721dbf8a3a2f/fc240/adrian.jpg","srcSet":"/static/cccbb7c63b7ff3e3ed1d721dbf8a3a2f/e26e9/adrian.jpg 32w,\n/static/cccbb7c63b7ff3e3ed1d721dbf8a3a2f/d306e/adrian.jpg 64w,\n/static/cccbb7c63b7ff3e3ed1d721dbf8a3a2f/fc240/adrian.jpg 128w,\n/static/cccbb7c63b7ff3e3ed1d721dbf8a3a2f/e270b/adrian.jpg 256w","sizes":"(min-width: 128px) 128px, 100vw"},"sources":[]},"width":128,"height":136}}}}],"title":"Bulk triage IPs with python and alienvault","description":"Simple python tool to bulk triage a huge list of IPs","date":"March 12th, 2023","categories":["python","alienvault","triage","forensics","ip-lookup","ioc","detection","threat-hunting"],"hero":{"medium":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAHFqhYUkBn/xAAaEAACAgMAAAAAAAAAAAAAAAAAAgEDEBNB/9oACAEBAAEFAq1hm0Yg4f/EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEDAQE/ASf/xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPwFn/8QAGxABAAAHAAAAAAAAAAAAAAAAAQARICExUYH/2gAIAQEABj8CunYmY2NP/8QAGhABAAIDAQAAAAAAAAAAAAAAAQARITFhEP/aAAgBAQABPyGoBOqiUQUGikcMaOIbPPP/2gAMAwEAAgADAAAAEBcP/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAR/9oACAEDAQE/EGYiT//EABYRAQEBAAAAAAAAAAAAAAAAAAEQQf/aAAgBAgEBPxAOT//EABwQAQEBAAIDAQAAAAAAAAAAAAERACExQVFhcf/aAAgBAQABPxD2hO9fiaruCDfXrjChbPJgKo7k4Kdpnf/Z"},"images":{"fallback":{"src":"/static/eaf91f584a482755f6329c47e8e31e10/0709d/pexels-photo-2047905.jpg","srcSet":"/static/eaf91f584a482755f6329c47e8e31e10/50c67/pexels-photo-2047905.jpg 236w,\n/static/eaf91f584a482755f6329c47e8e31e10/bd832/pexels-photo-2047905.jpg 472w,\n/static/eaf91f584a482755f6329c47e8e31e10/0709d/pexels-photo-2047905.jpg 944w,\n/static/eaf91f584a482755f6329c47e8e31e10/53023/pexels-photo-2047905.jpg 1888w","sizes":"(min-width: 944px) 944px, 100vw"},"sources":[]},"width":944,"height":531}}}},"fields":{"slug":"/bulk-triage-ips"},"relatedPosts":[{"id":"573140e1-2f65-5fc7-8fd4-abd75527ffd4","timeToRead":8.11,"fields":{"slug":"/hunting-malicious-usb"},"frontmatter":{"title":"Hunt for Malicious USB's","date":"March 15th, 2023","categories":["usb","malicious","hunt","sentinel","rubber-ducky","arduino","teensyduino"],"hero":{"normal":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIEA//EABYBAQEBAAAAAAAAAAAAAAAAAAIAAf/aAAwDAQACEAMQAAABvhpRFTU2/8QAGxAAAQQDAAAAAAAAAAAAAAAAAQACERIDIUH/2gAIAQEAAQUC4zLJs8oizqydhf/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EAB4QAAIBAwUAAAAAAAAAAAAAAAABESEiMQJBUWGR/9oACAEBAAY/ApNVtFgtVOziBrBt4f/EABoQAQADAQEBAAAAAAAAAAAAAAEAESExcaH/2gAIAQEAAT8hHaqLwj1HWB9JWt+EwtURUOy8rUf/2gAMAwEAAgADAAAAEIjP/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQMBAT8QR//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/EFf/xAAdEAEAAQQDAQAAAAAAAAAAAAABABEhMUFRYYGh/9oACAEBAAE/EBG0pd4O4rJQREWrQPYvrIuHtFFbxTkcjzE0gkkKpautx1Q23fGf/9k="},"images":{"fallback":{"src":"/static/efc880e68877ee224965d0c826a19e9b/c3879/FRONTPIC.jpg","srcSet":"/static/efc880e68877ee224965d0c826a19e9b/feb4a/FRONTPIC.jpg 192w,\n/static/efc880e68877ee224965d0c826a19e9b/357c8/FRONTPIC.jpg 384w,\n/static/efc880e68877ee224965d0c826a19e9b/c3879/FRONTPIC.jpg 768w,\n/static/efc880e68877ee224965d0c826a19e9b/abfa2/FRONTPIC.jpg 1536w","sizes":"(min-width: 768px) 768px, 100vw"},"sources":[]},"width":768,"height":496}}},"description":"Hunting for known malicious USB devices."}},{"id":"0aae5430-42f5-5449-9888-3fbe0442113b","timeToRead":4.005,"fields":{"slug":"/streamlining-incident-Management-with-chatgpt"},"frontmatter":{"title":"Streamlining Incident Management with ChatGPT","date":"March 7th, 2023","categories":["Cyber Security","AI","SIEM"],"hero":{"normal":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFi0lEQVR42h2PaVATZgJAP5YjHHJXLgmHQBIgJJAQkERB0MqpgHIIJViUI9AQGAER8KAoWkQjUqioUIloaKCKpVQ61Vpbe+3qLtWOtTN17bHtzFpnd2e6s7/fTvvv/XrznpDEb0Iiz0YSY8BDkU2AZishqSV4KTbiLc/EO249PjHr8IlOxS8qmdBYLTGyVPwDwgj2DyHMJ5AQDy9C3SSEOLsgvHRl+GTW4mvYyarUUgLWlRG6sYbA9FICtVtZnZJPcHIuUk0e8nVFRCWuJyI6mTWha4kNjkAWEIza1w+1lydxLs4Iv411rM4zEVXeTcRWC2tyG4ksaEJd2UVKWRua0hbSS5vJLjeT9mIVKt0WlIkZaBQaNJFxpIWFUxSxhmw/bwq83RExLx0ksf41ZDX9pDQOkdr4GuqaXnJajpP3yiBlnafY2T5E3d4hjKZedlQ0UVpURXFWHuUZWdTq0mhJSWJn2GoqfDwQOUccZHRMoGs+iaF1BEPLMJvMw5T1jFN7eIL6/gmaDryOue80rfuO09DQyZF9/Zh2VLMrazPmzA28HC+jcW0YpjB/RFb3BbafuEblyetsO2xj+8EpGk/NcWj6Jta3PuLs/G0uLnzMOfsNhkbepK9nkFc7+uip3YM5L59mfTr79ansU8ViDvNF1Iy8g2nyNnWji7RP3aRr6gPGl+7zt6fPePjzv/niyTN+fPYfnjz9hcXlT7C9OYu1/zhvdPdwek8dI1Xbmawo5FBKHG2/C1vOL9MwtsiB2buM33zI2eX73H38C8dvf0fa2OfIh++wZfIey4//yW/Pn/P0m8e8PXWRt61W5g/28O5+CyPbNtOfHEO/LAgxffcbpj5+xOLK9yzce8LKj7+y234fYXoLsX0Ap6RcRMoOwtpnMNu/pPPKp3zxlwd8Yr+M42g/NnM9JwpzOKJPojsuCDF+4x7LD77nh3/9l19/+x/T937Co+MabnXjeMal45FTj6e2EIl2G6LpEqJhGt2Rd/jyzyusXHPg6Otiorac0W0bGTYoEbYPv+Lzb//B1z89o/nqA2L7l4g+sIBfgRk39Rb8W22sqhrEQ25A+so55AcX8G2bRT+4yA9fP+Th3AzzvZ2cLi/kxCYd4oOVv/Po5+d03fgWYZkncK+dFzoduKeV4BooxT1ag0Sq/IODqgeIPnAded88Ee0z5B2d473ry9was3KqsoTTuRmIO199R+2VvyJMswR2LxC4/xoBHQ7cZOtwcZXgrMjEJVSBs4s7/llGwtttSNttBFmmEdVjaC1vcHVkBGtFMccyNQjHZ4/w7biKaJ0j9tUbxBxaJGSvHU/Felxd3HAp7sVVnY+bsyvOhhpEwxROLZdxsszhbLazymhl0vo6tj1VDOpVCPuH95ENvIcwOXC3zOLddAHPXaO4aIoRzm4IeSYiKBYnz0CcivYjTJcQrY4/AkSDDXnLWeZPDjNels8pQyLizMwSvZfvoBxYQtqzQESXgwjzJJHGY4TqCggIjyUoRkVUfhOxpnFke23Iu+zIuuzou20MHTvDiLECs3ItTaE+iKzqNpoPn2Hg/DzDM0uMzi4zMfc+toVbzCzcYmxylonpeSYuznP2whXOnb/E9AUb561jjO7r5mhFCU3JcoxhflSt+v1ocxXJRXVs2FFPkbGFst0WqhvaMdZb2NPURm2dCWPNbmp2GjFWVrOrvJKXi0uoycmiRJVIYbSU4hA/Cnwl5Lq5IkK0eYSnFRCZlkuUNofo5A0otFnEp6xHkaRDqdKRpNKiVmlJSUpBm6giVaZAGxmJLjSY9AAf9F4SdEKgFgLhH6/nhQQ9QYkGQpUGpEo90coMYpXpxCXoiFfqSEjUoExQo05QoZbFk7w2BnW4FHXQalQ+XiT9yYlsjZSCVC3/B+gDSMeGr7y3AAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/25b555edce0fffe232fce4c88dc827d5/d6cbb/featured-image.png","srcSet":"/static/25b555edce0fffe232fce4c88dc827d5/bd5e2/featured-image.png 192w,\n/static/25b555edce0fffe232fce4c88dc827d5/9b474/featured-image.png 384w,\n/static/25b555edce0fffe232fce4c88dc827d5/d6cbb/featured-image.png 768w","sizes":"(min-width: 768px) 768px, 100vw"},"sources":[]},"width":768,"height":768}}},"description":"My latest obsession, like many others, has been ChatGPT. Everything from making detailed backstories to fictional characters to brainstorming how to finish a sentence."}},{"id":"1c4cfd0d-b343-50a3-8ce5-e918b1c914cb","timeToRead":1.19,"fields":{"slug":"/book-en-workshop"},"frontmatter":{"title":"Book en Microsoft workshop med Fortytwo","date":"February 28th, 2023","categories":["Microsoft","Workshops"],"hero":{"normal":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAEDAgX/xAAVAQEBAAAAAAAAAAAAAAAAAAABAP/aAAwDAQACEAMQAAAB41YsciI//8QAFhABAQEAAAAAAAAAAAAAAAAAARAA/9oACAEBAAEFAjIQv//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABYQAAMAAAAAAAAAAAAAAAAAAAAgQf/aAAgBAQAGPwIq/wD/xAAbEAACAgMBAAAAAAAAAAAAAAAAARFBITFx0f/aAAgBAQABPyFU3EMhejBbgqHs/9oADAMBAAIAAwAAABBzD//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABwQAQADAAIDAAAAAAAAAAAAAAEAETEhgXGRsf/aAAgBAQABPxAdcV0ciEUiir4vVRbcHuffNdZp5n//2Q=="},"images":{"fallback":{"src":"/static/bfc3f9f08dff7d6396f0e3a92633e284/f3b7a/book-en-workshop-splash.jpg","srcSet":"/static/bfc3f9f08dff7d6396f0e3a92633e284/e1db8/book-en-workshop-splash.jpg 192w,\n/static/bfc3f9f08dff7d6396f0e3a92633e284/798de/book-en-workshop-splash.jpg 384w,\n/static/bfc3f9f08dff7d6396f0e3a92633e284/f3b7a/book-en-workshop-splash.jpg 768w,\n/static/bfc3f9f08dff7d6396f0e3a92633e284/69f85/book-en-workshop-splash.jpg 1536w","sizes":"(min-width: 768px) 768px, 100vw"},"sources":[]},"width":768,"height":349}}},"description":"5 gode grunner til å booke en workshop hos Fortytwo. Er du på jakt etter en måte å forbedre din bedrifts kunnskap og ferdigheter på? Da bør du vurdere å booke en workshop hos Fortytwo."}}]}},"pageContext":{"slug":"/bulk-triage-ips","tableOfContentsLevels":2,"previous":{"title":"Hunt for Malicious USB's","slug":"/hunting-malicious-usb"},"next":{"title":"Streamlining Incident Management with ChatGPT","slug":"/streamlining-incident-Management-with-chatgpt"},"frontmatter":{"title":"Bulk triage IPs with python and alienvault","author":["Adrian Kydland Skaftun"],"date":"2023-03-12T00:00:00.000Z","categories":["python","alienvault","triage","forensics","ip-lookup","ioc","detection","threat-hunting"],"description":"Simple python tool to bulk triage a huge list of IPs","hero":"media/pexels-photo-2047905.jpeg","slug":"bulk-triage-ips"}}},"staticQueryHashes":["176088207"],"slicesMap":{}}