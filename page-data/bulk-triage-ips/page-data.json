{"componentChunkName":"component---node-modules-pitayan-gatsby-theme-pitayan-src-templates-post-index-tsx-content-file-path-content-posts-2023-03-12-bulk-triage-ips-with-alienvault-and-python-index-mdx","path":"/bulk-triage-ips/","result":{"data":{"mdx":{"body":"\n# Python and Alienvault\n\nI recently identified the need to perform a triage on several hundred IPs extracted from a log that was not associated with any SIEM or CTI solution. To address this, I utilized simple scripting techniques to compile the data into a user-friendly list of IPs for Python to interpret. Despite my efforts to locate a suitable tool for this purpose, the majority of my findings consisted of outdated and extensive codebases, making it difficult to pinpoint my specific requirements. As a result, I seized the opportunity to write a simple tool to meet my needs. Although the code may not be aesthetically pleasing, it effectively provides the necessary feedback. I am confident that this code snippet can be of great value to others facing similar challenges, and the best part is that it does not require any prior coding experience to utilize and generate results. Just add in your Alienvault API key and the list of IPs as commented in the code and run it like any other python script.\n\nThis script performs a comprehensive analysis of each IP address provided, cross-referencing it with information from AlienVault. Specifically, it examines any suspicious activity within the malware section that occurred within the timeframe defined by the variable lookback (which is currently set to 30 days). Upon completion of the analysis, each IP address is stored in the designated file ```ips.txt```.\n\n\n```python\nfrom datetime import datetime, timedelta\nimport json\nimport requests\nimport os\nimport concurrent.futures\n\nlookback = 30\n\nimport os\n\nfilename = 'ips.txt'\n# Create file if not existing\nif not os.path.exists(filename):\n    open(filename, 'w').close()\n\n# Insert your AlienVault API key\nAPI_KEY = \"\"\n\n# Insert a list of IP addresses to check\nips = []\n\n\nOTX_API_ENDPOINT = \"https://otx.alienvault.com/api/v1/indicators/IPv6/{ip}/{malware}\"\nHEADERS = {\"X-OTX-API-KEY\": API_KEY}\n\ndef check_date(date_str):\n    date = datetime.strptime(date_str.split('T')[0], '%Y-%m-%d')\n    delta = datetime.now() - date\n    if delta < timedelta(days=lookback):\n        return True\n\ntriage_ips = []\nwith open('ips.txt', 'r') as f:\n    existing_ips = set(f.read().splitlines())\n\nwith open('ips.txt', 'a') as f:\n    with requests.Session() as session:\n        def process_ip(ip):\n            if ip in existing_ips:\n                print(f\"Skipping {ip} as it already exists in the file\")\n                return\n\n            try:\n                with session.get(f\"https://otx.alienvault.com/api/v1/indicators/IPv4/{ip}/reputation\", stream=True) as reputation:\n                    reputation.raise_for_status()\n                    reputation_data = reputation.json()\n                with session.get(f\"https://otx.alienvault.com/api/v1/indicators/IPv4/{ip}/malware\", stream=True) as malware:\n                    malware.raise_for_status()\n                    malware_data = malware.json()\n                    date_values = [d['date'] for d in malware_data['data']]\n                    for date in date_values:\n                        if check_date(date):\n                            triage_ips.append(ip)\n                            print(ip)\n                            f.write(f\"{ip}\\n\")\n                            break\n            except requests.exceptions.HTTPError as e:\n                print(f\"Error: {e} for {ip}\")\n            except json.decoder.JSONDecodeError:\n                print(f\"Error: JSON decoding failed for {ip}\")\n\n        with concurrent.futures.ThreadPoolExecutor() as executor:\n            executor.map(process_ip, ips)\n\nprint(\"Triage these IPs:\", triage_ips)\n\n```\n\n\nMoving forward, it would be interesting to add a few triage levels based on different lookbacks stored in separate files for 7 days, 14 days and 30 days and possibly avoid duplicates between them (where the most recent IP activity gets precedense).\n\nAny additions or suggestions, please reach out through ![github](https://github.com/amestofortytwo/python_snippets) issues or any other SoMe.","timeToRead":2.33,"tableOfContents":{"items":[{"url":"#python-and-alienvault","title":"Python and Alienvault"}]},"frontmatter":{"author":[{"id":"7efe43a5-8dae-5391-b8c0-1c2acebf8c2e","yamlId":"adriankydlandskaftun","name":"Adrian Kydland Skaftun","initial":"AKS","bio":"Cyber security engineer\n","sns":[["linkedin","https://www.linkedin.com/in/akskaftun/"],["github","https://github.com/bittib010"],["mailto","mailto:adrian.skaftun@amesto.no"]],"avatar":{"normal":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAVABQDASIAAhEBAxEB/8QAGQABAQADAQAAAAAAAAAAAAAAAAQBAgMF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQIA/9oADAMBAAIQAxAAAAGrEnUrqkaZtSj0Qb//xAAaEAACAwEBAAAAAAAAAAAAAAABAgAREiED/9oACAEBAAEFAm4FPdkzR1dG57MWfXSwn//EABkRAAEFAAAAAAAAAAAAAAAAAAABAhARIf/aAAgBAwEBPwFqYVP/xAAZEQABBQAAAAAAAAAAAAAAAAAAAQIQESH/2gAIAQIBAT8Bculz/8QAHBAAAgICAwAAAAAAAAAAAAAAAAECEBEhMWFx/9oACAEBAAY/Aq5HKWcd34I3FM//xAAaEAEAAwEBAQAAAAAAAAAAAAABABEhMVFh/9oACAEBAAE/IX85SaewFa7jSAWCIVDLjNIcOCLXAE8mG19Z/9oADAMBAAIAAwAAABCr6MP/xAAYEQADAQEAAAAAAAAAAAAAAAAAAREQIf/aAAgBAwEBPxBa7xWU/8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAR/9oACAECAQE/EFdFuwsL/8QAHBABAQEBAAIDAAAAAAAAAAAAAREAITFRQYGh/9oACAEBAAE/EJqsLHCQxE+nCOK7GZ4MiYL8T93lQih7mnAZzxlqKyDwZ5mGQh3jvvJ4wSvXf//Z"},"images":{"fallback":{"src":"/static/cccbb7c63b7ff3e3ed1d721dbf8a3a2f/fc240/adrian.jpg","srcSet":"/static/cccbb7c63b7ff3e3ed1d721dbf8a3a2f/e26e9/adrian.jpg 32w,\n/static/cccbb7c63b7ff3e3ed1d721dbf8a3a2f/d306e/adrian.jpg 64w,\n/static/cccbb7c63b7ff3e3ed1d721dbf8a3a2f/fc240/adrian.jpg 128w,\n/static/cccbb7c63b7ff3e3ed1d721dbf8a3a2f/e270b/adrian.jpg 256w","sizes":"(min-width: 128px) 128px, 100vw"},"sources":[]},"width":128,"height":136}}}}],"title":"Bulk triage IPs with python and alienvault","description":"Simple python tool to bulk triage a huge list of IPs","date":"March 12th, 2023","categories":["python","alienvault","triage","forensics","ip-lookup","ioc","detection","threat-hunting"],"hero":{"medium":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAHFqhYUkBn/xAAaEAACAgMAAAAAAAAAAAAAAAAAAQIDEBNB/9oACAEBAAEFAq4py0J4Rw//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAwEBPwEn/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQIBAT8BZ//EABwQAAEDBQAAAAAAAAAAAAAAAAEAAhEgITFhgf/aAAgBAQAGPwK5HVIxp1P/xAAaEAEAAgMBAAAAAAAAAAAAAAABABEhMXEQ/9oACAEBAAE/IakU6iBCwbBjhiRxDbnn/9oADAMBAAIAAwAAABAXD//EABYRAQEBAAAAAAAAAAAAAAAAAAEQEf/aAAgBAwEBPxBmIk//xAAWEQEBAQAAAAAAAAAAAAAAAAABEEH/2gAIAQIBAT8QDk//xAAaEAEBAQEBAQEAAAAAAAAAAAABEQAhYTGB/9oACAEBAAE/EAXpcD+m6mgTR62cwoWx+4iqOVRinDM7/9k="},"images":{"fallback":{"src":"/static/55be4b3628ce46e7548cc815ac780ee9/0709d/pexels-photo-2047905.jpg","srcSet":"/static/55be4b3628ce46e7548cc815ac780ee9/50c67/pexels-photo-2047905.jpg 236w,\n/static/55be4b3628ce46e7548cc815ac780ee9/bd832/pexels-photo-2047905.jpg 472w,\n/static/55be4b3628ce46e7548cc815ac780ee9/0709d/pexels-photo-2047905.jpg 944w","sizes":"(min-width: 944px) 944px, 100vw"},"sources":[]},"width":944,"height":531}}}},"fields":{"slug":"/bulk-triage-ips"},"relatedPosts":[{"id":"a9a4e086-4c58-50f9-b7f8-52c23a5467b9","timeToRead":5.035,"fields":{"slug":"/ingess-reverse-proxy"},"frontmatter":{"title":"Simplifying Reverse Proxy Management for external services with Kubernetes Ingress Controller","date":"May 5th, 2023","categories":["Kubernetes","Docker"],"hero":{"normal":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAEDBAX/xAAWAQEBAQAAAAAAAAAAAAAAAAAEAwL/2gAMAwEAAhADEAAAAc1kWbnhdoVnECSyJW//xAAaEAACAwEBAAAAAAAAAAAAAAABAgADERMx/9oACAEBAAEFAg2qgq5GsxkwUYWLV6WJC+mf/8QAGREAAwADAAAAAAAAAAAAAAAAAAECEBES/9oACAEDAQE/AYW2cojH/8QAGREAAgMBAAAAAAAAAAAAAAAAAAIBEBIh/9oACAECAQE/AW5Bsav/xAAcEAACAgIDAAAAAAAAAAAAAAAAARARAjEiMnH/2gAIAQEABj8CrJDvtC0cpXhs/8QAHBAAAgIDAQEAAAAAAAAAAAAAAAERMUFRYSGB/9oACAEBAAE/IbiPayQiepIo9BbtE9PpiiVN4H+wZzY//9oADAMBAAIAAwAAABAE6H//xAAXEQEBAQEAAAAAAAAAAAAAAAABABAh/9oACAEDAQE/ECorhz//xAAZEQACAwEAAAAAAAAAAAAAAAAAARAhMVH/2gAIAQIBAT8Qa4bcMR//xAAfEAEBAAICAQUAAAAAAAAAAAABEQAxIUFhUXGRsdH/2gAIAQEAAT8QGx1x6dp6/eKHV6a/Mqtc4j6PtMduBoIEKQCw+TnBQcTihvA+lMPGIjULse8KzR5z/9k="},"images":{"fallback":{"src":"/static/ed96061090a400fb2e7e2114abdb8dce/3c367/proxyrobot.jpg","srcSet":"/static/ed96061090a400fb2e7e2114abdb8dce/19e71/proxyrobot.jpg 128w,\n/static/ed96061090a400fb2e7e2114abdb8dce/68974/proxyrobot.jpg 256w,\n/static/ed96061090a400fb2e7e2114abdb8dce/3c367/proxyrobot.jpg 512w","sizes":"(min-width: 512px) 512px, 100vw"},"sources":[]},"width":768,"height":768}}},"description":"Can you actually use the ingress-controller as a reverse proxy for your external services and can you get ssl for a service outside kubernetes as simply as inside?"}},{"id":"2ccf325d-a90c-549f-acd9-4f14ca8bca32","timeToRead":5.015,"fields":{"slug":"/blazor-theme-switcher"},"frontmatter":{"title":"Microsoft Blazor app ThemeSwitcher","date":"April 17th, 2023","categories":["Blazor",".NET"],"hero":{"normal":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACv0lEQVR42l2T+UuTcRzH99dIUbnLEqIwiiLQZWzPs6nYSXZA0EEUSNnlbO55tplp5jFDpcOK+qnDTs2jVS5nVpKZllhemZt5tbRXPN9JRF948/kefN6f6/3VyWY3sknBZshH21vj3WxY6MKywCXs/0hd5MKqdyOZFNITPTiWqtgTFGSzgt2sorObFSSjyuaVZ9m2opQcx0POHwlQdvQFRYeezaNFoPBgC+U5L7hR1EHWqkrSlnlIjssjOc6JZcEZJIOCzp6gIptUstadZ+caP7cruqm//pn2hiHGR6NMRmaZGp8TVjuPDc8w3DfFzQshXtZ3UVPQQG1JMzf9ATISfeis+nxsBgVrfD77UmvofROm5/UYP8Z+Mh6eZqg/zPv2r7QHPtHa0I22ZqOg7LvHfqmC4ztqce2/RfaWS2QuL0C3c30J5XkPqC1pIvS0n/DItHB6/fyziF7tredwRo3o3UXliXgbG5rGn9tI9qbLIpnNKwtF2bJRRbc1qVA4HJAqyc64RuRblKmJKDfKnnHhVB2XzzVS7nyIZFQINvaI7IKP+ml7NMirx1/Ym1KB3eQlfZlPtE5nM7hF9OS4XLYnlREZiTIRmeFqcTMlJ+sozb1PUc5drhQ38XtOK3eO/g8ROloGqMoNUX36LScy72DVu7CbPdqUVRwJXrRe7l7rZ/z7T1HWu2AfV4qfUuV7TNO9zljvfv0mVD9I4PZXXHvq2LWuXCjDYdb8nUJ+uph+PGIoWav9fAyFGeydZLhvmq62b3S+HGagZ5KB3kl6OsKUHgly61wXlacCHE6vZndyEZZFJ7EandiMeTFCrXaNXTK5kQ0+JIMXSe/BYfaRZi5ANniRTV5SF6pUOVsZ/TLD1YKg0J6WjGxyYzU4Bf4hVNmoP03KkmNY5pGyOAbLP3dyglv8KpvxDFZj3l9fyRgj/QPziUncHp9AUAAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/40d87eb2c1052cf0b51d99e2fb87696b/fa1d9/blazor.png","srcSet":"/static/40d87eb2c1052cf0b51d99e2fb87696b/b034f/blazor.png 192w,\n/static/40d87eb2c1052cf0b51d99e2fb87696b/1809e/blazor.png 384w,\n/static/40d87eb2c1052cf0b51d99e2fb87696b/fa1d9/blazor.png 768w","sizes":"(min-width: 768px) 768px, 100vw"},"sources":[]},"width":768,"height":418}}},"description":"When working on my Blazor portal project, I realized that I needed a way to easily switch between light and dark themes, and to make sure that the user's selection persisted even after a page refresh. To accomplish this, I decided to create a service class that could handle theme switching and storage."}},{"id":"fce26083-3279-5b1c-9b3c-6d052f33a3d5","timeToRead":2.82,"fields":{"slug":"/hvorfor-msp"},"frontmatter":{"title":"Hvorfor tilbyr vi Managed Security Posture som en tjeneste?","date":"March 28th, 2023","categories":["Cyber Security","Security Posture","M365 Defender","Azure AD","Hardening","Proaktiv sikkerhet"],"hero":{"normal":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAADLAAAAywAEoZFrbAAACOElEQVR42mNgwALq6+uZQPSXly8l1m/akrVs1dqCJctWZ2/Zsi3m/////MhqiAGMIGLjtm1ppU2d73yT8/+HZpde8U7KuxmYXvS/vmvig3379nkTZeiqVauYQfT6TVvSU0rr/0tbuP8VN3H5b+obfUnXPeS6mInzf0Vbn/+FdW2/Du/f7wJS+///f+yG/v//H+yyL69eSdZ0THiu5RL839g74peRd8R/u9CkK0beETdNfKP/m/hE/jT0jvzfMWnGqf///7Mg+wqr6zZu25YcmF78X9cj7K91cMJf86CE//YRKVeNfKJu2Yal/HePy/qr6uj/Pya/8v+ZM2cckfViNXDhstUZvok5N428I06ZB8ScMfGNvOSTlLPaNTZjvZl/7GWroPgzRt6Rp2PzK65v3b3bh6CBS1atKfNPyntn6BVx38wv+qGxT9QLr/isvc7RqQdBbHP/6IcgubCs4nfbt2/3Jmjg3r0HokIyS/4bekf8tQ5J+GsTlvTfLjz5qql/zC3bsOT/ngk5f7VcQ/7HF1b9vnLlvBnOiIFFCiidtU2ccUvDOei/upP/Ly3X4P82IQlXDLzCbup5hv/XcQv5AYqUKXMW7SaYAGE2Hdh7wKu4qeununPQf1BSMfaJvKLlGnRDxNj5v75XxP+m3skvr54/r01UWoQpOH38tEPnxBkXYvMr/8cX1V5JKK69mVRc+3/yzPl7b125ooXsK2JcCvM+y9UzF223bt3puWvv3qAbNy6boqtBBwDrFCdQujxAKwAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/4619c94bb1148f03b190e970a2e607e4/e1368/msp-loop.png","srcSet":"/static/4619c94bb1148f03b190e970a2e607e4/6b9ea/msp-loop.png 192w,\n/static/4619c94bb1148f03b190e970a2e607e4/d8939/msp-loop.png 384w,\n/static/4619c94bb1148f03b190e970a2e607e4/e1368/msp-loop.png 768w","sizes":"(min-width: 768px) 768px, 100vw"},"sources":[]},"width":768,"height":457}}},"description":"Del 3 i serien om konfigurasjonskontroll, som metode for å øke motstandsdyktigheten i skyløsninger, handler om endringer knyttet til autentiseringsmetoder og tilhørende funksjoner i Azure AD."}}]}},"pageContext":{"slug":"/bulk-triage-ips","tableOfContentsLevels":2,"previous":{"title":"Hunt for Malicious USB's","slug":"/hunting-malicious-usb"},"next":{"title":"Streamlining Incident Management with ChatGPT","slug":"/streamlining-incident-Management-with-chatgpt"},"frontmatter":{"title":"Bulk triage IPs with python and alienvault","author":["Adrian Kydland Skaftun"],"date":"2023-03-12T00:00:00.000Z","categories":["python","alienvault","triage","forensics","ip-lookup","ioc","detection","threat-hunting"],"description":"Simple python tool to bulk triage a huge list of IPs","hero":"media/pexels-photo-2047905.jpeg","slug":"bulk-triage-ips"}}},"staticQueryHashes":["176088207"],"slicesMap":{}}