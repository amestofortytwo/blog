{"componentChunkName":"component---node-modules-pitayan-gatsby-theme-pitayan-src-templates-post-index-tsx-content-file-path-home-runner-work-blog-blog-content-posts-2023-03-12-bulk-triage-ips-with-alienvault-and-python-index-mdx","path":"/bulk-triage-ips/","result":{"data":{"mdx":{"body":"\n# Python and Alienvault\n\nI recently identified the need to perform a triage on several hundred IPs extracted from a log that was not associated with any SIEM or CTI solution. To address this, I utilized simple scripting techniques to compile the data into a user-friendly list of IPs for Python to interpret. Despite my efforts to locate a suitable tool for this purpose, the majority of my findings consisted of outdated and extensive codebases, making it difficult to pinpoint my specific requirements. As a result, I seized the opportunity to write a simple tool to meet my needs. Although the code may not be aesthetically pleasing, it effectively provides the necessary feedback. I am confident that this code snippet can be of great value to others facing similar challenges, and the best part is that it does not require any prior coding experience to utilize and generate results. Just add in your Alienvault API key and the list of IPs as commented in the code and run it like any other python script.\n\nThis script performs a comprehensive analysis of each IP address provided, cross-referencing it with information from AlienVault. Specifically, it examines any suspicious activity within the malware section that occurred within the timeframe defined by the variable lookback (which is currently set to 30 days). Upon completion of the analysis, each IP address is stored in the designated file ```ips.txt```.\n\n\n```python\nfrom datetime import datetime, timedelta\nimport json\nimport requests\nimport os\nimport concurrent.futures\n\nlookback = 30\n\nimport os\n\nfilename = 'ips.txt'\n# Create file if not existing\nif not os.path.exists(filename):\n    open(filename, 'w').close()\n\n# Insert your AlienVault API key\nAPI_KEY = \"\"\n\n# Insert a list of IP addresses to check\nips = []\n\n\nOTX_API_ENDPOINT = \"https://otx.alienvault.com/api/v1/indicators/IPv6/{ip}/{malware}\"\nHEADERS = {\"X-OTX-API-KEY\": API_KEY}\n\ndef check_date(date_str):\n    date = datetime.strptime(date_str.split('T')[0], '%Y-%m-%d')\n    delta = datetime.now() - date\n    if delta < timedelta(days=lookback):\n        return True\n\ntriage_ips = []\nwith open('ips.txt', 'r') as f:\n    existing_ips = set(f.read().splitlines())\n\nwith open('ips.txt', 'a') as f:\n    with requests.Session() as session:\n        def process_ip(ip):\n            if ip in existing_ips:\n                print(f\"Skipping {ip} as it already exists in the file\")\n                return\n\n            try:\n                with session.get(f\"https://otx.alienvault.com/api/v1/indicators/IPv4/{ip}/reputation\", stream=True) as reputation:\n                    reputation.raise_for_status()\n                    reputation_data = reputation.json()\n                with session.get(f\"https://otx.alienvault.com/api/v1/indicators/IPv4/{ip}/malware\", stream=True) as malware:\n                    malware.raise_for_status()\n                    malware_data = malware.json()\n                    date_values = [d['date'] for d in malware_data['data']]\n                    for date in date_values:\n                        if check_date(date):\n                            triage_ips.append(ip)\n                            print(ip)\n                            f.write(f\"{ip}\\n\")\n                            break\n            except requests.exceptions.HTTPError as e:\n                print(f\"Error: {e} for {ip}\")\n            except json.decoder.JSONDecodeError:\n                print(f\"Error: JSON decoding failed for {ip}\")\n\n        with concurrent.futures.ThreadPoolExecutor() as executor:\n            executor.map(process_ip, ips)\n\nprint(\"Triage these IPs:\", triage_ips)\n\n```\n\n\nMoving forward, it would be interesting to add a few triage levels based on different lookbacks stored in separate files for 7 days, 14 days and 30 days and possibly avoid duplicates between them (where the most recent IP activity gets precedense).\n\nAny additions or suggestions, please reach out through ![github](https://github.com/amestofortytwo/python_snippets) issues or any other SoMe.","timeToRead":2.33,"tableOfContents":{"items":[{"url":"#python-and-alienvault","title":"Python and Alienvault"}]},"frontmatter":{"author":[{"id":"7efe43a5-8dae-5391-b8c0-1c2acebf8c2e","yamlId":"adriankydlandskaftun","name":"Adrian Kydland Skaftun","initial":"AKS","bio":"Cyber security engineer\n","sns":[["linkedin","https://www.linkedin.com/in/akskaftun/"],["github","https://github.com/bittib010"],["mailto","mailto:adrian.skaftun@amesto.no"]],"avatar":{"normal":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAVABQDASIAAhEBAxEB/8QAGQABAQADAQAAAAAAAAAAAAAAAAQBAgMF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQIA/9oADAMBAAIQAxAAAAGrEnUrqkaZtSj0Qb//xAAaEAACAwEBAAAAAAAAAAAAAAABAgAREiED/9oACAEBAAEFAm4FPdkzR1dG57MWfXSwn//EABkRAAEFAAAAAAAAAAAAAAAAAAABAhARIf/aAAgBAwEBPwFqYVP/xAAZEQABBQAAAAAAAAAAAAAAAAAAAQIQESH/2gAIAQIBAT8Bculz/8QAHBAAAgICAwAAAAAAAAAAAAAAAAECEBEhMWFx/9oACAEBAAY/Aq5HKWcd34I3FM//xAAaEAEAAwEBAQAAAAAAAAAAAAABABEhMVFh/9oACAEBAAE/IX85SaewFa7jSAWCIVDLjNIcOCLXAE8mG19Z/9oADAMBAAIAAwAAABCr6MP/xAAYEQADAQEAAAAAAAAAAAAAAAAAAREQIf/aAAgBAwEBPxBa7xWU/8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAR/9oACAECAQE/EFdFuwsL/8QAHBABAQEBAAIDAAAAAAAAAAAAAREAITFRQYGh/9oACAEBAAE/EJqsLHCQxE+nCOK7GZ4MiYL8T93lQih7mnAZzxlqKyDwZ5mGQh3jvvJ4wSvXf//Z"},"images":{"fallback":{"src":"/static/cccbb7c63b7ff3e3ed1d721dbf8a3a2f/fc240/adrian.jpg","srcSet":"/static/cccbb7c63b7ff3e3ed1d721dbf8a3a2f/e26e9/adrian.jpg 32w,\n/static/cccbb7c63b7ff3e3ed1d721dbf8a3a2f/d306e/adrian.jpg 64w,\n/static/cccbb7c63b7ff3e3ed1d721dbf8a3a2f/fc240/adrian.jpg 128w,\n/static/cccbb7c63b7ff3e3ed1d721dbf8a3a2f/e270b/adrian.jpg 256w","sizes":"(min-width: 128px) 128px, 100vw"},"sources":[]},"width":128,"height":136}}}}],"title":"Bulk triage IPs with python and alienvault","description":"Simple python tool to bulk triage a huge list of IPs","date":"March 12th, 2023","categories":["python","alienvault","triage","forensics","ip-lookup","ioc","detection","threat-hunting"],"hero":{"medium":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAHFqhYUkBn/xAAaEAACAgMAAAAAAAAAAAAAAAAAAgEDEBNB/9oACAEBAAEFAq1hm0Yg4f/EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEDAQE/ASf/xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPwFn/8QAGxABAAAHAAAAAAAAAAAAAAAAAQARICExUYH/2gAIAQEABj8CunYmY2NP/8QAGhABAAIDAQAAAAAAAAAAAAAAAQARITFhEP/aAAgBAQABPyGoBOqiUQUGikcMaOIbPPP/2gAMAwEAAgADAAAAEBcP/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAR/9oACAEDAQE/EGYiT//EABYRAQEBAAAAAAAAAAAAAAAAAAEQQf/aAAgBAgEBPxAOT//EABwQAQEBAAIDAQAAAAAAAAAAAAERACExQVFhcf/aAAgBAQABPxD2hO9fiaruCDfXrjChbPJgKo7k4Kdpnf/Z"},"images":{"fallback":{"src":"/static/eaf91f584a482755f6329c47e8e31e10/0709d/pexels-photo-2047905.jpg","srcSet":"/static/eaf91f584a482755f6329c47e8e31e10/50c67/pexels-photo-2047905.jpg 236w,\n/static/eaf91f584a482755f6329c47e8e31e10/bd832/pexels-photo-2047905.jpg 472w,\n/static/eaf91f584a482755f6329c47e8e31e10/0709d/pexels-photo-2047905.jpg 944w,\n/static/eaf91f584a482755f6329c47e8e31e10/53023/pexels-photo-2047905.jpg 1888w","sizes":"(min-width: 944px) 944px, 100vw"},"sources":[]},"width":944,"height":531}}}},"fields":{"slug":"/bulk-triage-ips"},"relatedPosts":[{"id":"fce26083-3279-5b1c-9b3c-6d052f33a3d5","timeToRead":2.82,"fields":{"slug":"/hvorfor-msp"},"frontmatter":{"title":"Hvorfor tilbyr vi Managed Security Posture som en tjeneste?","date":"March 28th, 2023","categories":["Cyber Security","Security Posture","M365 Defender","Azure AD","Hardening","Proaktiv sikkerhet"],"hero":{"normal":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAADLAAAAywAEoZFrbAAAC7UlEQVR42n2SSUyTURSFb//uWLiCjRs2Thg0ULQoDg1CoXQA2hToZKWgAi0IEUUNLjSGEIcoSgDBVAQLVDr8dPg7oEaGUhCrKVSxRmVYKYm4k+CCXPMSTSBVb/IWb3G/nHPuAdgwn9/PASJC2dlGlsvtBVz/GT/kZKr6LXSdyWw1MB6fGhHjAuMBMPYOULKTtfDfWV5aAJXhHKvd2ANuj6+84dqNFYGmAqWn6pZyNZXL4lI9Xr15b350ZCyX8frhoclMPbENgdlKx8I6ux9D1yMT2814wcV4ddrai7iVy8cETibuk6hmknPkc/GcTEw8lIc1jddwIjDBezk5CVbaSQ3aHLFA2uFm4foa4M8fCZeabn3blSVFjkixliIswaPFZRGOSBFNEysJfHWvoAib7rS9IfGQZ7E7Y4GtXd1sG+0EG+08LTqhx+RcOR6UagkAecVlH1OEJYvkz9dU4jaeBBX6epycCGYRlf2DdioGeKvtAbvN2AuP+gcrJLrqaKpIMc0tUIfSxMpZka7GwtdU0tx89WyGTPuKI1JOa+suzXl8w2Lf8DMYsNKUxb7BNpF8o7WT6urph74ntvMF5WdWUoWKBW6+ejFNrPwiLDU8y1ZXjOyTqL6mF2gWU4WK+ZKq+hWPbziPHMdspdmb1FlpJ3QYe9l+/1NgPH6NRGdAkl2GTIsHCo/jkSLdh/0S1TyxLNDqMSlbiurqBgyHQtxwKPR3y0MuhvU75LgrN+8u7MgswJ3HCteSsqR4WF4aSckrju7JkZNsV/fmyvFOh/E5wBayyrI73LFHmZ6cggGLnQqMjcPIi9EcUo3tPMmf2kR282VRUptkvgwvN9/+/m4mvDMaiYCb8VFDTubvxb5+rwMe9PRRXt8wBMYDmc0t7eGSqrOorG74pK5uWDp+5gK23Dc+fxsOJwUnguB0eSgSEyn3P0dlOA/dJjNF6kAimAoGeQ63V+Dx+mUzr1+nQ2IKEGUOF0P1Dligs9u0CfALQLx/is9a94wAAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/4619c94bb1148f03b190e970a2e607e4/e1368/msp-loop.png","srcSet":"/static/4619c94bb1148f03b190e970a2e607e4/6b9ea/msp-loop.png 192w,\n/static/4619c94bb1148f03b190e970a2e607e4/d8939/msp-loop.png 384w,\n/static/4619c94bb1148f03b190e970a2e607e4/e1368/msp-loop.png 768w","sizes":"(min-width: 768px) 768px, 100vw"},"sources":[]},"width":768,"height":457}}},"description":"Del 3 i serien om konfigurasjonskontroll, som metode for å øke motstandsdyktigheten i skyløsninger, handler om endringer knyttet til autentiseringsmetoder og tilhørende funksjoner i Azure AD."}},{"id":"31147a64-7b4a-5478-8550-2949afb44205","timeToRead":2.59,"fields":{"slug":"/microsoft-defender-suite-comprehensive-cybersecurity"},"frontmatter":{"title":"Microsoft Defender Suite - Comprehensive Cybersecurity for Today's Digital Landscape","date":"March 21st, 2023","categories":["Cyber Security","Defender","Hardening","Microsoft","Fortytwo","Security Posture"],"hero":{"normal":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIDBAX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAFo95CRsD//xAAaEAEAAgMBAAAAAAAAAAAAAAABAgMABBMU/9oACAEBAAEFArduZZ7Z5r3NlbXBecMAD//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABoQAQACAwEAAAAAAAAAAAAAAAEAEQIxkTL/2gAIAQEABj8CcQN1NYy05LcSeDkoKJ//xAAbEAEAAgIDAAAAAAAAAAAAAAABABEhMUFxgf/aAAgBAQABPyEHethCvz1N2Y1YwxmmuLSGfpitIOCf/9oADAMBAAIAAwAAABAQD//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABwQAQACAgMBAAAAAAAAAAAAAAEAIRExQVGhYf/aAAgBAQABPxA9cgHUxy3v5F2yLjffe/IpYvegBfsAs2QVSMeTemuoT1ADAT//2Q=="},"images":{"fallback":{"src":"/static/a995acb9db16b7905be494e555958d32/87950/featured-image.jpg","srcSet":"/static/a995acb9db16b7905be494e555958d32/24f17/featured-image.jpg 192w,\n/static/a995acb9db16b7905be494e555958d32/da955/featured-image.jpg 384w,\n/static/a995acb9db16b7905be494e555958d32/87950/featured-image.jpg 768w","sizes":"(min-width: 768px) 768px, 100vw"},"sources":[]},"width":768,"height":430}}},"description":"The Microsoft Defender suite is a versatile and powerful cybersecurity solution that provides comprehensive protection against various cyber threats. Its different tools work together seamlessly to defend against attacks at different stages of an attack chain, helping organizations to detect and respond to potential security breaches and protect users and confidential data from malicious actors."}},{"id":"573140e1-2f65-5fc7-8fd4-abd75527ffd4","timeToRead":8.11,"fields":{"slug":"/hunting-malicious-usb"},"frontmatter":{"title":"Hunt for Malicious USB's","date":"March 15th, 2023","categories":["usb","malicious","hunt","sentinel","rubber-ducky","arduino","teensyduino"],"hero":{"normal":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIEA//EABYBAQEBAAAAAAAAAAAAAAAAAAIAAf/aAAwDAQACEAMQAAABvhpRFTU2/8QAGxAAAQQDAAAAAAAAAAAAAAAAAQACERIDIUH/2gAIAQEAAQUC4zLJs8oizqydhf/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EAB4QAAIBAwUAAAAAAAAAAAAAAAABESEiMQJBUWGR/9oACAEBAAY/ApNVtFgtVOziBrBt4f/EABoQAQADAQEBAAAAAAAAAAAAAAEAESExcaH/2gAIAQEAAT8hHaqLwj1HWB9JWt+EwtURUOy8rUf/2gAMAwEAAgADAAAAEIjP/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQMBAT8QR//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/EFf/xAAdEAEAAQQDAQAAAAAAAAAAAAABABEhMUFRYYGh/9oACAEBAAE/EBG0pd4O4rJQREWrQPYvrIuHtFFbxTkcjzE0gkkKpautx1Q23fGf/9k="},"images":{"fallback":{"src":"/static/efc880e68877ee224965d0c826a19e9b/c3879/FRONTPIC.jpg","srcSet":"/static/efc880e68877ee224965d0c826a19e9b/feb4a/FRONTPIC.jpg 192w,\n/static/efc880e68877ee224965d0c826a19e9b/357c8/FRONTPIC.jpg 384w,\n/static/efc880e68877ee224965d0c826a19e9b/c3879/FRONTPIC.jpg 768w,\n/static/efc880e68877ee224965d0c826a19e9b/abfa2/FRONTPIC.jpg 1536w","sizes":"(min-width: 768px) 768px, 100vw"},"sources":[]},"width":768,"height":496}}},"description":"Hunting for known malicious USB devices."}}]}},"pageContext":{"slug":"/bulk-triage-ips","tableOfContentsLevels":2,"previous":{"title":"Hunt for Malicious USB's","slug":"/hunting-malicious-usb"},"next":{"title":"Streamlining Incident Management with ChatGPT","slug":"/streamlining-incident-Management-with-chatgpt"},"frontmatter":{"title":"Bulk triage IPs with python and alienvault","author":["Adrian Kydland Skaftun"],"date":"2023-03-12T00:00:00.000Z","categories":["python","alienvault","triage","forensics","ip-lookup","ioc","detection","threat-hunting"],"description":"Simple python tool to bulk triage a huge list of IPs","hero":"media/pexels-photo-2047905.jpeg","slug":"bulk-triage-ips"}}},"staticQueryHashes":["176088207"],"slicesMap":{}}